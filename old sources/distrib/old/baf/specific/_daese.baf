///////////////////////////////////////////////////////////////////////
// Initialization script
// - sleep
// - initialization
// - cast long protection spells
///////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Just after resting, everything is reset and creature is healed
/////////////////////////////////////////////////////////////////////
IF
  GlobalTimerExpired("ja#PrepTimer","LOCALS")
  !Global("ja#initialize","LOCALS",0)
  !See(NearestEnemyOf(Myself))
THEN
  RESPONSE #100
    Rest()
    ForceSpellRES("spin124",Myself) // Shapeshifts Natural Form
    SelectWeaponAbility(SLOT_WEAPON,0)
    ApplySpellRES("JA#HEAL",Myself)
    SetGlobal("ja#initialize","LOCALS",0)
END


///////////////////////////////////////////////////////////////////////
// Initialize variables & timers
///////////////////////////////////////////////////////////////////////
IF
  Global("ja#initialize","LOCALS",0)
THEN
  RESPONSE #100
    SetGlobal("ja#initialize","LOCALS",1)
    SetGlobal("ja#disable_spellcasting","LOCALS",0)
    SetGlobal("ja#long_duration_spells","LOCALS",0)
    SetGlobal("ja#contingency","LOCALS",0)
    SetGlobal("ja#sequencer","LOCALS",0)
    SetGlobal("ja#buffdone","LOCALS",0)
    SetGlobal("ja#polymorph","LOCALS",0)
    SetGlobal("ja#combat","LOCALS",0)
    SetGlobalTimer("ja#PrepTimer","LOCALS",2400)
END


/////////////////////////////////////////////////////////////////////
// Mages always cast their long protection spells before combat
// (long = 1 turn per level, and in general more than 5 turns)
// Also some long duration weapons & summons
////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////
// Stoneskin
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_STONE_SKIN)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_STONE_SKIN)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Protection from fire
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_FIRE)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_FIRE)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Protection from cold
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_COLD)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_COLD)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Protection from eletricity
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_ELECTRICITY)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_ELECTRICITY)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Protection from acid
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_ACID)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_ACID)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Protection from magical energy
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_MAGIC_ENERGY)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Armor
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_ARMOR)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_ARMOR)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Ghost armor
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_GHOST_ARMOR)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_GHOST_ARMOR)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Spirit armor
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_SPIRIT_ARMOR)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_SPIRIT_ARMOR)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Strength
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_STRENGTH)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_STRENGTH)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Resist fear
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_RESIST_FEAR)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_RESIST_FEAR)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Melf meteor
/////////////////////////////////////////////////////////////////////
IF
  False() // Disable because it's too powerful, isn't it?
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_MELF_METEOR)
  CheckStatLT(Myself,20,LEVEL)  
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_MELF_METEOR)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// Animate Dead
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
  HaveSpell(WIZARD_ANIMATE_DEAD)
THEN
  RESPONSE #100
    ReallyForceSpell(Myself,WIZARD_ANIMATE_DEAD)
    Continue()
END


/////////////////////////////////////////////////////////////////////
// End of long protection spells 
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#long_duration_spells","LOCALS",0)
THEN
  RESPONSE #100
    SetGlobal("ja#long_duration_spells","LOCALS",1)
END


///////////////////////////////////////////////////////////////////////
// Threat Detection for mages
// - turn hostile if the mage or his summons are being attacked
// - alert nearby allies
///////////////////////////////////////////////////////////////////////


///////////////////////////////////////////////////////////////////////
// Attacked? Spell cast on me? Someone shouted a warning?
///////////////////////////////////////////////////////////////////////
IF
  !Allegiance(Myself,ENEMY)
  OR(12)
    AttackedBy([GOODCUTOFF.0.0.0.0.SUMMONED],DEFAULT)
    AttackedBy([PC],DEFAULT)
    AttackedBy([FAMILIAR],DEFAULT)
    AttackedBy([ALLY],DEFAULT)
    AttackedBy([CONTROLLED],DEFAULT)
    AttackedBy([CHARMED],DEFAULT)
    SpellCastOnMe([GOODCUTOFF.0.0.0.0.SUMMONED],0)
    SpellCastOnMe([PC],0)
    SpellCastOnMe([FAMILIAR],0)
    SpellCastOnMe([ALLY],0)
    SpellCastOnMe([CONTROLLED],0)
    SpellCastOnMe([CHARMED],0)
THEN
  RESPONSE #100
    Enemy()
END

// Summons are beeing attack
IF
  Heard([ANYONE],98)
  Allegiance(Myself,NEUTRAL)
THEN
  RESPONSE #100
    Enemy()
END

// Adventurers are beeing attack
IF
  Heard([ANYONE],97)
  Allegiance(Myself,NEUTRAL)
THEN
  RESPONSE #100
    Enemy()
    //MoveToObject(LastHeardBy(Myself))
    SetGlobal("ja#combat","LOCALS",1)
END

IF
  Heard([ANYONE],97)
  !See(NearestEnemyOf(Myself))  
THEN
  RESPONSE #100
    //MoveToObject(LastHeardBy(Myself))
    SetGlobal("ja#combat","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Alert nearby allies if an enemy is spotted
/////////////////////////////////////////////////////////////////////
IF
  See(NearestEnemyOf(Myself))
  !GlobalTimerNotExpired("ja#shout","LOCALS")
THEN
  RESPONSE #100
    SetGlobal("ja#combat","LOCALS",1)
    VerbalConstant(Myself,BATTLE_CRY)
    SetGlobalTimer("ja#shout","LOCALS",30)
    Shout(97)
END


/////////////////////////////////////////////////////////////////////
// Lay on hands
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HPPercentLT(Myself,60)
  HaveSpellRES("spcl211")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl211",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HaveSpellRES("spcl815")
  HPPercentLT(Myself,60)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl815",Myself)
END


/////////////////////////////////////////////////////////////////////
// Healing potions
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("POTN55",Myself) // Potion of Superior Healing
  HPPercentLT(Myself,50)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("POTN55",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("POTN52",Myself) // Potion of Extra Healing
  HPPercentLT(Myself,60)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("POTN52",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN17",Myself) // Elixir of Health
  OR(2)
    HPPercentLT(Myself,30)
    StateCheck(Myself,STATE_POISONED)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN17",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN08",Myself) // Potion of Healing
  HPPercentLT(Myself,30)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN08",Myself)
END


///////////////////////////////////////////////////////////////////////
// Movement and Tracking
///////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Thieves will try to hide
/////////////////////////////////////////////////////////////////////
IF
  OR(2)
    Class(Myself,THIEF)
    Class(Myself,THIEF_ALL)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Myself,STATE_INVISIBLE)
  !GlobalTimerNotExpired("ja#action_hide","LOCALS")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#action_hide","LOCALS",9)
    Hide()
END

IF
  OR(2)
    Class(Myself,THIEF)
    Class(Myself,THIEF_ALL)
  See(NearestEnemyOf(Myself))
  !StateCheck(Myself,STATE_INVISIBLE)
  !GlobalTimerNotExpired("Stealth","LOCALS")
  !RandomNum(4,1) // Sometimes, it's good to fight
THEN
  RESPONSE #100
    RunAwayFromNoInterrupt(NearestEnemyOf(Myself),45)
END

// If thief is not invisible, he won't track down an enemy not in sight
IF
  OR(2)
    Class(Myself,THIEF)
    Class(Myself,THIEF_ALL)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Are there any enemies that try to escape, follow them
// It's not about sight but memory (I saw that enemy going in that dir.)
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#combat","LOCALS",1)
  !See(NearestEnemyOf(Myself))
  !StateCheck(LastAttackerOf(Myself),STATE_INVISIBLE)
  Range(LastAttackerOf(Myself),70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(LastAttackerOf(Myself))
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player1,STATE_INVISIBLE)
  Range(Player1,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player1)
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player2,STATE_INVISIBLE)
  Range(Player2,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player2)
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player3,STATE_INVISIBLE)
  Range(Player3,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player3)
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player4,STATE_INVISIBLE)
  Range(Player4,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player4)
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player5,STATE_INVISIBLE)
  Range(Player5,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player5)
END

IF
  Global("ja#combat","LOCALS",1)
  Allegiance(Myself,ENEMY)
  !See(NearestEnemyOf(Myself))
  !StateCheck(Player6,STATE_INVISIBLE)
  Range(Player6,70)
  OR(2)
    !Class(Myself,THIEF_ALL)
    StateCheck(Myself,STATE_INVISIBLE)
THEN
  RESPONSE #100
    MoveToObject(Player6)
END


///////////////////////////////////////////////////////////////////////
// Behavior if no enemies have been seen
///////////////////////////////////////////////////////////////////////
IF
  !See(NearestEnemyOf(Myself))
  Global("ja#random_walk","LOCALS",1)
THEN
  RESPONSE #100
    RandomWalk()
END

IF
  !See(NearestEnemyOf(Myself))
  Global("ja#random_walk","LOCALS",0)
THEN
  RESPONSE #100
    NoAction()
END


///////////////////////////////////////////////////////////////////////
// Mage : necromancer
// - contingency and chain contingencies
// - minor sequencer, spell sequencer, spell trigger
///////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Contingency, level 12-14
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#contingency","LOCALS",0)
  CheckStatGT(Myself,11,LEVEL)
  CheckStatLT(Myself,15,LEVEL)
THEN
  RESPONSE #100
    SetGlobal("ja#contingency","LOCALS",1)
    DisplayString(Myself,84763) // Contingency Released
    ReallyForceSpell(Myself,WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)
END


/////////////////////////////////////////////////////////////////////
// Contingency, level 15-17
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#contingency","LOCALS",0)
  CheckStatGT(Myself,14,LEVEL)
  CheckStatLT(Myself,18,LEVEL)
THEN
  RESPONSE #100
    SetGlobal("ja#contingency","LOCALS",1)
    DisplayString(Myself,84763) // Contingency Released
    ReallyForceSpell(NearestEnemyOf(Myself),WIZARD_ANIMATE_DEAD)
END


/////////////////////////////////////////////////////////////////////
// Chain contingencies, level 18+
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#contingency","LOCALS",0)
  CheckStatGT(Myself,17,LEVEL)
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobal("ja#contingency","LOCALS",1)
    DisplayString(Myself,26328) // Chain Contingency
    ReallyForceSpell(NearestEnemyOf(Myself),WIZARD_ABI_DALZIMS_HORRID_WILTING)
    ReallyForceSpell(NearestEnemyOf(Myself),WIZARD_FINGER_OF_DEATH)
    ReallyForceSpell(NearestEnemyOf(Myself),WIZARD_ABI_DALZIMS_HORRID_WILTING)
END

IF
  Global("ja#contingency","LOCALS",0)
  CheckStatGT(Myself,17,LEVEL)
THEN
  RESPONSE #100
    SetGlobal("ja#contingency","LOCALS",1)
    DisplayString(Myself,26328) // Chain Contingency
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_ENERGY)
    ReallyForceSpell(Myself,WIZARD_SPELL_TURNING)
    ReallyForceSpell(Myself,WIZARD_ANIMATE_DEAD)
END


/////////////////////////////////////////////////////////////////////
// Minor sequencer, level 7-13
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,7,LEVEL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,8635) // Minor Sequencer Activated
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_SLEEP)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_HORROR)
    SetGlobal("ja#sequencer","LOCALS",1)
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStatGT(Myself,7,LEVEL)
  CheckStatLT(Myself,14,LEVEL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,8635) // Minor Sequencer Activated
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_HORROR)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_HORROR)
    SetGlobal("ja#sequencer","LOCALS",1)
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStatGT(Myself,6,LEVEL)
  CheckStatLT(Myself,14,LEVEL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,8635) // Minor Sequencer Activated
    ReallyForceSpell(Myself,WIZARD_SHIELD)
    ReallyForceSpell(Myself,WIZARD_RESIST_FEAR)
    SetGlobal("ja#sequencer","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Spell sequencer, level 14
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,14,LEVEL)
  CheckStat(Myself,1,MINORGLOBE)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,25951) // Spell Sequencer
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_VAMPIRIC_TOUCH)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_SKULL_TRAP)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_SKULL_TRAP)
    SetGlobal("ja#sequencer","LOCALS",1)
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,14,LEVEL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,25951) // Spell Sequencer
    ReallyForceSpell(Myself,WIZARD_FIRE_SHIELD_BLUE)
    ReallyForceSpell(Myself,WIZARD_SPIDER_SPAWN)
    ReallyForceSpell(Myself,WIZARD_SPIRIT_ARMOR)
    SetGlobal("ja#sequencer","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Spell sequencer, level 15
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,15,LEVEL)
  CheckStat(Myself,6,SCRIPTINGSTATE6)  // Immunity evocation
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,25951) // Spell Sequencer
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_VAMPIRIC_TOUCH)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_SKULL_TRAP)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_SKULL_TRAP)
    SetGlobal("ja#sequencer","LOCALS",1)
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,15,LEVEL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,25951) // Spell Sequencer
    ReallyForceSpell(Myself,WIZARD_FIRE_SHIELD_BLUE)
    ReallyForceSpell(Myself,WIZARD_SPIDER_SPAWN)
    ReallyForceSpell(Myself,WIZARD_SPIRIT_ARMOR)
    SetGlobal("ja#sequencer","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Spell trigger, level 16-17
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStatGT(Myself,15,LEVEL)
  CheckStatLT(Myself,18,LEVEL)
  See(NearestEnemyOf(Myself))
  !RandomNum(4,1)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,26243) // Spell Trigger
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_DEATH_SPELL)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_ANIMATE_DEAD)
    ReallyForceSpell(LastSeenBy(Myself),WIZARD_ANIMATE_DEAD)
    SetGlobal("ja#sequencer","LOCALS",1)
END

IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStatGT(Myself,15,LEVEL)
  CheckStatLT(Myself,18,LEVEL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,26243) // Spell Trigger
    ReallyForceSpell(Myself,WIZARD_TRUE_SIGHT)
    ReallyForceSpell(Myself,WIZARD_GLOBE_OF_INVULNERABILITY)
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
    SetGlobal("ja#sequencer","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Spell trigger, level 18+
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#sequencer","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStatGT(Myself,17,LEVEL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    DisplayString(Myself,26243) // Spell Trigger
    ReallyForceSpell(Myself,WIZARD_ANIMATE_DEAD)    
    ReallyForceSpell(Myself,WIZARD_GLOBE_OF_INVULNERABILITY)
    ReallyForceSpell(Myself,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
    SetGlobal("ja#sequencer","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Shapeshift
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#polymorph","LOCALS",0)
  //Dead("mendas3")
  OR(2)
    HPPercentLT(Myself,70)
    Global("ja#disable_spellcasting","LOCALS",1)
THEN
  RESPONSE #100
    SetInterrupt(FALSE)
    SetGlobal("ja#polymorph","LOCALS",1)
    SetGlobalTimer("ja#round","LOCALS",6)
    SelectWeaponAbility(SLOT_WEAPON1,0)  // (Greater)Wolfwere  _AESEWLF.CRE
    Wait(6) // Morphing time
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
    SetInterrupt(TRUE)
END


///////////////////////////////////////////////////////////////////////
// Spellcasting for mages
// - protection/buff spells
///////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Counter silence
/////////////////////////////////////////////////////////////////////
IF
  StateCheck(Myself,STATE_SILENCED)
  HaveSpell(WIZARD_VOCALIZE)  
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_VOCALIZE)
END


/////////////////////////////////////////////////////////////////////
// Back to human form
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#polymorph","LOCALS",1)  
  CheckStat(Myself,0,POLYMORPH_SELF) 
  !Race(Myself,LYCANTHROPE)
THEN
  RESPONSE #100
    SetGlobal("ja#polymorph","LOCALS",0)
    SetGlobal("ja#disable_spellcasting","LOCALS",0)
END


/////////////////////////////////////////////////////////////////////
// Unable to cast a spell
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#disable_spellcasting","LOCALS",0)
  OR(2)
    StateCheck(Myself,STATE_SILENCED)
    CheckStatGT(Myself,69,SPELLFAILUREPRIEST)
THEN
  RESPONSE #100
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Able to cast a spell
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#disable_spellcasting","LOCALS",1)
  !StateCheck(Myself,STATE_SILENCED)
  CheckStatLT(Myself,70,SPELLFAILUREPRIEST)
  !CheckStat(Myself,1,SCRIPTINGSTATE3) // Tenser's tranformation
  !CheckStat(Myself,1,POLYMORPH_SELF)
  !CheckStat(Myself,1,WIZARD_MISLEAD)
  !Global("ja#polymorph","LOCALS",1)  
THEN
  RESPONSE #100
    SetGlobal("ja#disable_spellcasting","LOCALS",0)
END


/////////////////////////////////////////////////////////////////////
// Improved chaos shield
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpellRES("spwi723")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spwi723",Myself)
END


/////////////////////////////////////////////////////////////////////
// Chaos shield
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpellRES("spwi222")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spwi222",Myself)
END


/////////////////////////////////////////////////////////////////////
// Timestop
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_TIME_STOP)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_TIME_STOP)
END


/////////////////////////////////////////////////////////////////////
// Improved mantle
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_IMPROVED_MANTLE)
  CheckStat(Myself,0,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)  
  HitBy([ANYONE],CRUSHING)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_IMPROVED_MANTLE)
END


/////////////////////////////////////////////////////////////////////
// Mantle
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MANTLE)
  CheckStat(Myself,0,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  HitBy([ANYONE],CRUSHING)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MANTLE)
END


/////////////////////////////////////////////////////////////////////
// Protection from magical weapons
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  CheckStat(Myself,0,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  HitBy([ANYONE],CRUSHING)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
END


/////////////////////////////////////////////////////////////////////
// Stoneskin (recast when have less than 2 stoneskins)
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_STONE_SKIN)
  CheckStatLT(Myself,2,STONESKINS)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_STONE_SKIN)
END


/////////////////////////////////////////////////////////////////////
// Tenser Transformation when no more weapon protections
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_TENSERS_TRANSFORMATION)  
  !HaveSpell(WIZARD_PROTECTION_FROM_MAGIC_WEAPONS)
  !HaveSpell(WIZARD_STONE_SKIN)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_TENSERS_TRANSFORMATION)
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Mass invisibility
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_MASS_INVISIBILITY)
  OR(2)
    Global("ja#buffdone","LOCALS",0)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MASS_INVISIBILITY)
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Mislead
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_MISLEAD)
  OR(2)
    Global("ja#buffdone","LOCALS",0)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MISLEAD)
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Shadow door
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_SHADOW_DOOR)
  OR(2)
    Global("ja#buffdone","LOCALS",0)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SHADOW_DOOR)
END


/////////////////////////////////////////////////////////////////////
// Improved invisibilty
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_IMPROVED_INVISIBILITY)
  OR(2)
    Global("ja#buffdone","LOCALS",0)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_IMPROVED_INVISIBILITY)
END


/////////////////////////////////////////////////////////////////////
// Invisibility
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_INVISIBILITY)
  Global("ja#buffdone","LOCALS",0)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_INVISIBILITY)
END


/////////////////////////////////////////////////////////////////////
// Potion of invisibility
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !StateCheck(Myself,STATE_INVISIBLE)  
  HasItem("_POTN10",Myself) // Potion of Invisibility
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN10",Myself) // Potion of Invisibility
END


/////////////////////////////////////////////////////////////////////
// Invisibility on 3 meters
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !StateCheck(Myself,STATE_INVISIBLE)
  HaveSpell(WIZARD_INVISIBILITY_10_FOOT)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_INVISIBILITY_10_FOOT)
END


/////////////////////////////////////////////////////////////////////
// Protection from the elements
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_THE_ELEMENTS)
  See(NearestEnemyOf(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_PROTECTION_FROM_THE_ELEMENTS)
END


/////////////////////////////////////////////////////////////////////
// Protection from normal weapons
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,0,WIZARD_PROTECTION_FROM_NORMAL_WEAPONS)
  HaveSpell(WIZARD_PROTECTION_FROM_NORMAL_WEAPONS)
  See(NearestEnemyOf(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_PROTECTION_FROM_NORMAL_WEAPONS)
END


/////////////////////////////////////////////////////////////////////
// Globe of invulnerability
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_GLOBE_OF_INVULNERABILITY)  
  CheckStat(Myself,0,MINORGLOBE)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_GLOBE_OF_INVULNERABILITY)
END


/////////////////////////////////////////////////////////////////////
// Minor globe of invulnerability
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)
  CheckStat(Myself,0,MINORGLOBE)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MINOR_GLOBE_OF_INVULNERABILITY)
END


/////////////////////////////////////////////////////////////////////
// Spell immunity
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPELL_IMMUNITY)  
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_IMMUNITY_INVOCATION)
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_IMMUNITY_ENCHANTMENT)
  RESPONSE #80
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_IMMUNITY_NECROMANCY)
  RESPONSE #80
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_IMMUNITY_ALTERATION)
  RESPONSE #60
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_IMMUNITY_CONJURATION)            
END


/////////////////////////////////////////////////////////////////////
// Spell turning
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPELL_TURNING)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_TURNING)
END


/////////////////////////////////////////////////////////////////////
// Spell deflection
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPELL_DEFLECTION)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SPELL_DEFLECTION)
END


/////////////////////////////////////////////////////////////////////
// Minor spell turning
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MINOR_SPELL_TURNING)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MINOR_SPELL_TURNING)
END


/////////////////////////////////////////////////////////////////////
// Minor spell deflection
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MINOR_SPELL_DEFLECTION)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MINOR_SPELL_DEFLECTION)
END


/////////////////////////////////////////////////////////////////////
// Blur
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_BLUR)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_BLUR)
END


/////////////////////////////////////////////////////////////////////
// Fire shield red
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !CheckStat(Myself,1,WIZARD_FIRE_SHIELD)
  HaveSpell(WIZARD_FIRE_SHIELD_RED)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_FIRE_SHIELD_RED)
END


/////////////////////////////////////////////////////////////////////
// Fire shield blue
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !CheckStat(Myself,2,WIZARD_FIRE_SHIELD)
  HaveSpell(WIZARD_FIRE_SHIELD_BLUE)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_FIRE_SHIELD_BLUE)
END


/////////////////////////////////////////////////////////////////////
// Mirror image
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MIRROR_IMAGE)  
  !StateCheck(Myself,STATE_MIRRORIMAGE)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MIRROR_IMAGE)
END


/////////////////////////////////////////////////////////////////////
// Reflected image
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_REFLECTED_IMAGE)  
  !StateCheck(Myself,STATE_MIRRORIMAGE)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_REFLECTED_IMAGE)
END


/////////////////////////////////////////////////////////////////////
// True sight
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,0,TRUE_SIGHT)
  HaveSpell(WIZARD_TRUE_SIGHT)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_TRUE_SIGHT)
END


/////////////////////////////////////////////////////////////////////
// Protection from evil
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_PROTECTION_FROM_EVIL)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_PROTECTION_FROM_EVIL)
END


/////////////////////////////////////////////////////////////////////
// Improved haste
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_IMPROVED_HASTE)
  !StateCheck(Myself,STATE_HASTED)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_IMPROVED_HASTE)
END


/////////////////////////////////////////////////////////////////////
// Haste
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_HASTE)
  !StateCheck(Myself,STATE_HASTED)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_HASTE)
END


/////////////////////////////////////////////////////////////////////
// Shield
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  !CheckStat(Myself,2,SCRIPTINGSTATE3) // Shield
  HaveSpell(WIZARD_SHIELD)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SHIELD)
END


/////////////////////////////////////////////////////////////////////
// Wraith form
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_WRAITH_FORM)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_WRAITH_FORM)
END


/////////////////////////////////////////////////////////////////////
// Potions of strength
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN04",Myself) // Potion of Frost Giant Strength
  CheckStatLT(Myself,19,STR)
THEN
  RESPONSE #100
    SetGlobalTimer("DrinkPotion","LOCALS",6)
    UseItem("_POTN04",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN12",Myself) // Potion of Stone Giant Strength
  CheckStatLT(Myself,19,STR)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN12",Myself)
END


/////////////////////////////////////////////////////////////////////
// Other potions
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !StateCheck(Myself,STATE_INVISIBLE)  
  HasItem("_POTN10",Myself) // Potion of Invisibility
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN10",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN18",Myself) // Potion of Absorption
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN18",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN09",Myself) // Potion of Heroism
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN09",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN14",Myself) // Oil of Speed
  !StateCheck(Myself,STATE_HASTED)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN14",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN34",Myself) // Potion of Magic Protection
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN34",LastSeenBy(Myself))
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN41",Myself) // Potion of Power
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN41",Myself)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HasItem("_POTN36",Myself) // Potion of Master Thievery
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_POTN36",Myself)
END


///////////////////////////////////////////////////////////////////////
// Special kit abilities
///////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Poison weapon
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !CheckStat(Myself,4,SCRIPTINGSTATE4)
  HaveSpellRES("spcl423")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl423",Myself)
END


/////////////////////////////////////////////////////////////////////
// Berserker rage
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !GlobalTimerNotExpired("ja#berserkerrage","LOCALS")
  HaveSpellRES("spcl321")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SetGlobalTimer("ja#berserkerrage","LOCALS",120)
    SpellRES("spcl321",Myself)
END


/////////////////////////////////////////////////////////////////////
// Barbarian rage
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !CheckStat(Myself,1,SCRIPTINGSTATE4)
  HaveSpellRES("spcl152")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl152",Myself)
END


/////////////////////////////////////////////////////////////////////
// Kai
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !GlobalTimerNotExpired("ja#kai","LOCALS")
  HaveSpellRES("spcl144")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SetGlobalTimer("ja#kai","LOCALS",10)
    SpellRES("spcl144",Myself)
END


/////////////////////////////////////////////////////////////////////
// Called shot
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !GlobalTimerNotExpired("ja#calledshot","LOCALS")
  HaveSpellRES("spcl121")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SetGlobalTimer("ja#calledshot","LOCALS",10)
    SpellRES("spcl121",Myself)
END


/////////////////////////////////////////////////////////////////////
// Protection from evil
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !CheckStat(Myself,3,SCRIPTINGSTATE3)
  HaveSpellRES("spcl213")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl213",Myself)
END


/////////////////////////////////////////////////////////////////////
// True sight
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  CheckStat(Myself,0,TRUE_SIGHT)
  HaveSpellRES("spcl232")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl232",Myself)
END


/////////////////////////////////////////////////////////////////////
// Dispel magic
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpellRES("spcl231")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl231",NearestEnemyOf(Myself))
END


/////////////////////////////////////////////////////////////////////
// Defensive spin
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !CheckStat(Myself,2,SCRIPTINGSTATE4)
  HitBy([ANYONE],CRUSHING)
  HaveSpellRES("spcl522")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl522",Myself)
END


/////////////////////////////////////////////////////////////////////
// Offensive spin
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !CheckStat(Myself,2,SCRIPTINGSTATE4)
  Global("ja#buffdone","LOCALS",1)
  HaveSpellRES("spcl521")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl521",Myself)
END


/////////////////////////////////////////////////////////////////////
// Stunning Blow
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !GlobalTimerNotExpired("ja#stunning","LOCALS")
  HaveSpellRES("spcl811")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SetGlobalTimer("ja#stunning","LOCALS",9)
    SpellRES("spcl811",Myself)
END


/////////////////////////////////////////////////////////////////////
// Quivering Palm
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  HaveSpellRES("spcl820")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spcl820",Myself)
END


/////////////////////////////////////////////////////////////////////
// If all buffing spells are done, combat can start
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#buffdone","LOCALS",0)
  !GlobalTimerNotExpired("ja#confirm","LOCALS")
  !GlobalTimerNotExpired("ja#round","LOCALS")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#confirm","LOCALS",2)
END

IF
  Global("ja#buffdone","LOCALS",0)
  !GlobalTimerNotExpired("ja#round","LOCALS")
  GlobalTimerNotExpired("ja#confirm","LOCALS")
THEN
  RESPONSE #100
    SetGlobal("ja#buffdone","LOCALS",1)
END

IF
  Global("ja#buffdone","LOCALS",0)
  OR(2)
    !StateCheck(Myself,STATE_INVISIBLE)
    !StateCheck(Myself,STATE_IMPROVEDINVISIBILITY)
  !HaveSpell(WIZARD_INVISIBILITY)
  !HaveSpell(WIZARD_IMPROVED_INVISIBILITY)
  !HaveSpell(WIZARD_SHADOW_DOOR)
  !HaveSpell(WIZARD_MISLEAD)
  !HaveSpell(WIZARD_MASS_INVISIBILITY)
THEN
  RESPONSE #100
    SetGlobal("ja#buffdone","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Not ready to attack, wait
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#buffdone","LOCALS",0)
THEN
  RESPONSE #100
    NoAction()
END
  

/////////////////////////////////////////////////////////////////////
// Now, it's time to kill things
// Priorities are:
//   Remove magic on buffed people
//   Power word
//   Charm/dominate the best fighter
//   Destroy mage's defense
//   Disable spells
//   Damage spells
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Find a target that has something to dispel
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)
    CheckStatGT(SixthNearestEnemyOf(Myself),18,STR)
    HasImmunityEffects(SixthNearestEnemyOf(Myself))
    CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)
    CheckStatGT(FifthNearestEnemyOf(Myself),18,STR)
    HasImmunityEffects(FifthNearestEnemyOf(Myself))
    CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)  
    CheckStatGT(FourthNearestEnemyOf(Myself),18,STR)
    HasImmunityEffects(FourthNearestEnemyOf(Myself))
    CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)
    CheckStatGT(ThirdNearestEnemyOf(Myself),18,STR)  
    HasImmunityEffects(ThirdNearestEnemyOf(Myself))  
    CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)
    CheckStatGT(SecondNearestEnemyOf(Myself),18,STR)
    HasImmunityEffects(SecondNearestEnemyOf(Myself))
    CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)  
    CheckStatGT(NearestEnemyOf(Myself),18,STR)
    HasImmunityEffects(NearestEnemyOf(Myself))
    CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Remove magic
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DISPEL_MAGIC)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(5)
    CheckStatGT(LastSeenBy(Myself),18,STR)
    HasImmunityEffects(LastSeenBy(Myself))
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DISPEL_MAGIC)
END


/////////////////////////////////////////////////////////////////////
// Breach
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_BREACH)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  OR(4)
    HasImmunityEffects(LastSeenBy(Myself))
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
    CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_BREACH)
END


/////////////////////////////////////////////////////////////////////
// Lower resistances
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_LOWER_RESISTANCE)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_LOWER_RESISTANCE)
END


/////////////////////////////////////////////////////////////////////
// Begin of block:
// Power word kill
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(SixthNearestEnemyOf(Myself),60)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(FifthNearestEnemyOf(Myself),60)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(FourthNearestEnemyOf(Myself),60)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(ThirdNearestEnemyOf(Myself),60)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(SecondNearestEnemyOf(Myself),60)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  HPLT(NearestEnemyOf(Myself),60)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POWER_WORD_KILL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  HPLT(LastSeenBy(Myself),60)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_KILL)
END
/////////////////////////////////////////////////////////////////////
// End of block:
// Power word kill
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Begin of block:
// Power word blind
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SixthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SixthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SixthNearestEnemyOf(Myself),RANGER_ALL)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FifthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FifthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FifthNearestEnemyOf(Myself),RANGER_ALL)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FourthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FourthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FourthNearestEnemyOf(Myself),RANGER_ALL)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(ThirdNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(ThirdNearestEnemyOf(Myself),PALADIN_ALL)
    Class(ThirdNearestEnemyOf(Myself),RANGER_ALL)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SecondNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SecondNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SecondNearestEnemyOf(Myself),RANGER_ALL)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(NearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(NearestEnemyOf(Myself),FIGHTER_ALL)
    Class(NearestEnemyOf(Myself),PALADIN_ALL)
    Class(NearestEnemyOf(Myself),RANGER_ALL)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POWER_WORD_BLIND)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(LastSeenBy(Myself),STATE_SLOWED)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  OR(3)
    Class(LastSeenBy(Myself),FIGHTER_ALL)
    Class(LastSeenBy(Myself),PALADIN_ALL)
    Class(LastSeenBy(Myself),RANGER_ALL)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_BLIND)
END
/////////////////////////////////////////////////////////////////////
// End of block:
// Power word blind
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Begin of block:
// Power word stun
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(SixthNearestEnemyOf(Myself),30)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(FifthNearestEnemyOf(Myself),30)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(FourthNearestEnemyOf(Myself),30)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(ThirdNearestEnemyOf(Myself),30)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(SecondNearestEnemyOf(Myself),30)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(NearestEnemyOf(Myself),30)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POWER_WORD_STUN)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage  
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(LastSeenBy(Myself),30)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_STUN)
END
/////////////////////////////////////////////////////////////////////
// End of block:
// Power word stun
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Begin of block:
// Power word silence
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(SixthNearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(SixthNearestEnemyOf(Myself),DRUID_ALL)
    Class(SixthNearestEnemyOf(Myself),BARD_ALL)
    Class(SixthNearestEnemyOf(Myself),CLERIC_ALL)
    Class(SixthNearestEnemyOf(Myself),MAGE_ALL)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(FifthNearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(FifthNearestEnemyOf(Myself),DRUID_ALL)
    Class(FifthNearestEnemyOf(Myself),BARD_ALL)
    Class(FifthNearestEnemyOf(Myself),CLERIC_ALL)
    Class(FifthNearestEnemyOf(Myself),MAGE_ALL)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(FourthNearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(FourthNearestEnemyOf(Myself),DRUID_ALL)
    Class(FourthNearestEnemyOf(Myself),BARD_ALL)
    Class(FourthNearestEnemyOf(Myself),CLERIC_ALL)
    Class(FourthNearestEnemyOf(Myself),MAGE_ALL)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(ThirdNearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(ThirdNearestEnemyOf(Myself),DRUID_ALL)
    Class(ThirdNearestEnemyOf(Myself),BARD_ALL)
    Class(ThirdNearestEnemyOf(Myself),CLERIC_ALL)
    Class(ThirdNearestEnemyOf(Myself),MAGE_ALL)  
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(SecondNearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(SecondNearestEnemyOf(Myself),DRUID_ALL)
    Class(SecondNearestEnemyOf(Myself),BARD_ALL)
    Class(SecondNearestEnemyOf(Myself),CLERIC_ALL)
    Class(SecondNearestEnemyOf(Myself),MAGE_ALL)  
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(NearestEnemyOf(Myself),STATE_SILENCED)
  CheckStatLT(NearestEnemyOf(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  OR(4)
    Class(NearestEnemyOf(Myself),DRUID_ALL)
    Class(NearestEnemyOf(Myself),BARD_ALL)
    Class(NearestEnemyOf(Myself),CLERIC_ALL)
    Class(NearestEnemyOf(Myself),MAGE_ALL)  
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POWER_WORD_SILENCE)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !StateCheck(LastSeenBy(Myself),STATE_SILENCED)
  CheckStatLT(LastSeenBy(Myself),49,SPELLFAILUREPRIEST)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  OR(4)
    Class(LastSeenBy(Myself),DRUID_ALL)
    Class(LastSeenBy(Myself),BARD_ALL)
    Class(LastSeenBy(Myself),CLERIC_ALL)
    Class(LastSeenBy(Myself),MAGE_ALL)  
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_SILENCE)
END
/////////////////////////////////////////////////////////////////////
// End of block:
// Power word silence
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Begin of block:
// Power word sleep
/////////////////////////////////////////////////////////////////////
IF
  !Race(SixthNearestEnemyOf(Myself),ELF)
  !CheckStat(SixthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(SixthNearestEnemyOf(Myself),21)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FifthNearestEnemyOf(Myself),ELF)
  !CheckStat(FifthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(FifthNearestEnemyOf(Myself),21)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FourthNearestEnemyOf(Myself),ELF)
  !CheckStat(FourthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(FourthNearestEnemyOf(Myself),21)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(ThirdNearestEnemyOf(Myself),ELF)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(ThirdNearestEnemyOf(Myself),21)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(SecondNearestEnemyOf(Myself),ELF)
  !CheckStat(SecondNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(SecondNearestEnemyOf(Myself),21)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(NearestEnemyOf(Myself),ELF)
  !CheckStat(NearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(NearestEnemyOf(Myself),21)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POWER_WORD_SLEEP)
  !Race(LastSeenBy(Myself),ELF)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  HPLT(LastSeenBy(Myself),21)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POWER_WORD_SLEEP)
END
/////////////////////////////////////////////////////////////////////
// End of block:
// Power word sleep
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Find a fighter to charm/dominate
/////////////////////////////////////////////////////////////////////
IF
  !Race(SixthNearestEnemyOf(Myself),ELF)
  !CheckStat(SixthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(SixthNearestEnemyOf(Myself),30)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SixthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SixthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SixthNearestEnemyOf(Myself),RANGER_ALL)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FifthNearestEnemyOf(Myself),ELF)
  !CheckStat(FifthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(FifthNearestEnemyOf(Myself),30)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FifthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FifthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FifthNearestEnemyOf(Myself),RANGER_ALL)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FourthNearestEnemyOf(Myself),ELF)
  !CheckStat(FourthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(FourthNearestEnemyOf(Myself),30)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FourthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FourthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FourthNearestEnemyOf(Myself),RANGER_ALL)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(ThirdNearestEnemyOf(Myself),ELF)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(ThirdNearestEnemyOf(Myself),30)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(ThirdNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(ThirdNearestEnemyOf(Myself),PALADIN_ALL)
    Class(ThirdNearestEnemyOf(Myself),RANGER_ALL)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(SecondNearestEnemyOf(Myself),ELF)
  !CheckStat(SecondNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(SecondNearestEnemyOf(Myself),30)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SecondNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SecondNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SecondNearestEnemyOf(Myself),RANGER_ALL)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(NearestEnemyOf(Myself),ELF)
  !CheckStat(NearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(NearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(NearestEnemyOf(Myself),30)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(NearestEnemyOf(Myself),FIGHTER_ALL)
    Class(NearestEnemyOf(Myself),PALADIN_ALL)
    Class(NearestEnemyOf(Myself),RANGER_ALL)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Great Malison before trying a charm spell
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_GREATER_MALISON)
  !CheckStat(LastSeenBy(Myself),1,WIZARD_GREATER_MALISON)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_GREATER_MALISON)
END


/////////////////////////////////////////////////////////////////////
// Domination
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DOMINATION)
  !Race(LastSeenBy(Myself),ELF)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLOWED)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  HPPercentGT(LastSeenBy(Myself),30)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  OR(3)
    Class(LastSeenBy(Myself),FIGHTER_ALL)
    Class(LastSeenBy(Myself),PALADIN_ALL)
    Class(LastSeenBy(Myself),RANGER_ALL)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DOMINATION)
END


IF
  !Race(SixthNearestEnemyOf(Myself),ELF)
  !CheckStat(SixthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(SixthNearestEnemyOf(Myself),30)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SixthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SixthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SixthNearestEnemyOf(Myself),RANGER_ALL)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FifthNearestEnemyOf(Myself),ELF)
  !CheckStat(FifthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(FifthNearestEnemyOf(Myself),30)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FifthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FifthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FifthNearestEnemyOf(Myself),RANGER_ALL)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(FourthNearestEnemyOf(Myself),ELF)
  !CheckStat(FourthNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(FourthNearestEnemyOf(Myself),30)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(FourthNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(FourthNearestEnemyOf(Myself),PALADIN_ALL)
    Class(FourthNearestEnemyOf(Myself),RANGER_ALL)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(ThirdNearestEnemyOf(Myself),ELF)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(ThirdNearestEnemyOf(Myself),30)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(ThirdNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(ThirdNearestEnemyOf(Myself),PALADIN_ALL)
    Class(ThirdNearestEnemyOf(Myself),RANGER_ALL)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(SecondNearestEnemyOf(Myself),ELF)
  !CheckStat(SecondNearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(SecondNearestEnemyOf(Myself),30)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(SecondNearestEnemyOf(Myself),FIGHTER_ALL)
    Class(SecondNearestEnemyOf(Myself),PALADIN_ALL)
    Class(SecondNearestEnemyOf(Myself),RANGER_ALL)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Race(NearestEnemyOf(Myself),ELF)
  !CheckStat(NearestEnemyOf(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLOWED)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(NearestEnemyOf(Myself),STATE_BLIND)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  HPPercentGT(NearestEnemyOf(Myself),30)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    Class(NearestEnemyOf(Myself),FIGHTER_ALL)
    Class(NearestEnemyOf(Myself),PALADIN_ALL)
    Class(NearestEnemyOf(Myself),RANGER_ALL)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Dire charm
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DIRE_CHARM)
  !Race(LastSeenBy(Myself),ELF)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLOWED)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  HPPercentGT(LastSeenBy(Myself),30)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  OR(3)
    Class(LastSeenBy(Myself),FIGHTER_ALL)
    Class(LastSeenBy(Myself),PALADIN_ALL)
    Class(LastSeenBy(Myself),RANGER_ALL)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DIRE_CHARM)
END


/////////////////////////////////////////////////////////////////////
// Charm person
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CHARM_PERSON)  
  !Race(LastSeenBy(Myself),ELF)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLOWED)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  HPPercentGT(LastSeenBy(Myself),30)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  OR(3)
    Class(LastSeenBy(Myself),FIGHTER_ALL)
    Class(LastSeenBy(Myself),PALADIN_ALL)
    Class(LastSeenBy(Myself),RANGER_ALL)
  See(LastSeenBy(Myself))  
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CHARM_PERSON)
END


/////////////////////////////////////////////////////////////////////
// *********************  Disabling spells *********************** //
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Level 6+ spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Symbol fear
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SYMBOL_FEAR)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SYMBOL_FEAR)
END


/////////////////////////////////////////////////////////////////////
// Bigbys Clenched Fist
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_BIGBYS_CLENCHED_FIST)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_BIGBYS_CLENCHED_FIST)
END


/////////////////////////////////////////////////////////////////////
// Primastic Spray
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_PRISMATIC_SPRAY)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_PRISMATIC_SPRAY)
END


/////////////////////////////////////////////////////////////////////
// Sphere of chaos
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPHERE_OF_CHAOS)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SPHERE_OF_CHAOS)
END


/////////////////////////////////////////////////////////////////////
// Finger of death
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_FINGER_OF_DEATH)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_FINGER_OF_DEATH)
END


/////////////////////////////////////////////////////////////////////
// Death spells
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DEATH_SPELL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DEATH_SPELL)
END


/////////////////////////////////////////////////////////////////////
// Disintegrate
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DISINTEGRATE)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DISINTEGRATE)
END


/////////////////////////////////////////////////////////////////////
// Flesh to stone
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_FLESH_TO_STONE)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_FLESH_TO_STONE)
END


/////////////////////////////////////////////////////////////////////
// Death fog
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DEATH_FOG)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DEATH_FOG)
END


/////////////////////////////////////////////////////////////////////
// Level 4-5 spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Great Malison before trying anything else
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_GREATER_MALISON)
  !CheckStat(LastSeenBy(Myself),1,WIZARD_GREATER_MALISON)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_GREATER_MALISON)
END


/////////////////////////////////////////////////////////////////////
// Cloud kill
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CLOUDKILL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CLOUDKILL)
END


/////////////////////////////////////////////////////////////////////
// Chaos
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CHAOS)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CHAOS)
END


/////////////////////////////////////////////////////////////////////
// Feeblemind
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_FEEBLEMIND)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_FEEBLEMIND)
END


/////////////////////////////////////////////////////////////////////
// Hold monsters
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_HOLD_MONSTER)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_HOLD_MONSTER)
END


/////////////////////////////////////////////////////////////////////
// Emotion
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_EMOTION_HOPELESSNESS)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_EMOTION_HOPELESSNESS)
END


/////////////////////////////////////////////////////////////////////
// Teleport field
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_TELEPORT_FIELD)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_TELEPORT_FIELD)
END


/////////////////////////////////////////////////////////////////////
// Level 3- spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(NearestEnemyOf(Myself),STATE_SLEEPING)
  !StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  !StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Hold person
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_HOLD_PERSON)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_HOLD_PERSON)
END


/////////////////////////////////////////////////////////////////////
// Web
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_WEB)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStat(Myself,1,MINORGLOBE)
    HasItemEquiped("_RING09",Myself) // Ring of Free Action
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_WEB)
END


/////////////////////////////////////////////////////////////////////
// Slow
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SLOW)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SLOW)
END


/////////////////////////////////////////////////////////////////////
// Stinking cloud
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_STINKING_CLOUD)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStat(Myself,1,MINORGLOBE)
    CheckStatGT(Myself,99,RESISTPOISON)
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_STINKING_CLOUD)
END


/////////////////////////////////////////////////////////////////////
// Horror
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_HORROR)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_HORROR)
END


/////////////////////////////////////////////////////////////////////
// Glitterdust
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_GLITTERDUST)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_GLITTERDUST)
END


/////////////////////////////////////////////////////////////////////
// Sleep
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SLEEP)
  !Race(LastSeenBy(Myself),ELF)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SLEEP)
END


/////////////////////////////////////////////////////////////////////
// Spook
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPOOK)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SPOOK)
END


/////////////////////////////////////////////////////////////////////
// Color spray
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_COLOR_SPRAY)
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_COLOR_SPRAY)
END


/////////////////////////////////////////////////////////////////////
// Wand of paralyzation
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HasItemEquiped("_WAND04",Myself) // Wand of Paralyzation
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  RandomNum(4,1) // 25% to use
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_WAND04",LastSeenBy(Myself)) // Wand of Paralyzation
END


/////////////////////////////////////////////////////////////////////
// Wand of fear
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HasItemEquiped("_WAND02",Myself) // Wand of Fear
  !CheckStat(LastSeenBy(Myself),1,SCRIPTINGSTATE4) // Rage
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  RandomNum(4,1) // 25% to use
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_WAND02",LastSeenBy(Myself)) // Wand of Fear
END


/////////////////////////////////////////////////////////////////////
// Ray of enfeeblement
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_RAY_OF_ENFEEBLEMENT)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(3)
    Class(LastSeenBy(Myself),FIGHTER_ALL)
    Class(LastSeenBy(Myself),PALADIN_ALL)
    Class(LastSeenBy(Myself),RANGER_ALL)  
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_RAY_OF_ENFEEBLEMENT)
END


/////////////////////////////////////////////////////////////////////
// Blindness
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_BLINDNESS)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  !StateCheck(LastSeenBy(Myself),STATE_STUNNED)
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_BLIND)
  !CheckStatGT(LastSeenBy(Myself),0,HELD)
  !StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_BLINDNESS)
END


/////////////////////////////////////////////////////////////////////
// *********************  Summoning spells *********************** //
/////////////////////////////////////////////////////////////////////


/////////////////////////////////////////////////////////////////////
// Planatar
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SUMMON_PLANATAR_GOOD)
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_SUMMON_PLANATAR_GOOD)
END


/////////////////////////////////////////////////////////////////////
// Mordenkainen sword
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MORDENKAINENS_SWORD)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_MORDENKAINENS_SWORD)
END


/////////////////////////////////////////////////////////////////////
// Hakeashar
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SUMMON_HAKEASHAR)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_SUMMON_HAKEASHAR)
END


/////////////////////////////////////////////////////////////////////
// Djinni
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SUMMON_DJINNI)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_SUMMON_DJINNI)
END


/////////////////////////////////////////////////////////////////////
// Efreeti
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SUMMON_EFREET)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_SUMMON_EFREET)
END


/////////////////////////////////////////////////////////////////////
// Wyvern
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_WYVERN_CALL)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_WYVERN_CALL)
END


/////////////////////////////////////////////////////////////////////
// Squeleton
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_ANIMATE_DEAD)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_ANIMATE_DEAD)
END


/////////////////////////////////////////////////////////////////////
// Monsters (3)
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MONSTER_SUMMONING_3)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_MONSTER_SUMMONING_3)
END


/////////////////////////////////////////////////////////////////////
// Spider
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SPIDER_SPAWN)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_SPIDER_SPAWN)
END


/////////////////////////////////////////////////////////////////////
// Monsters (2)
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MONSTER_SUMMONING_2)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_MONSTER_SUMMONING_2)
END


/////////////////////////////////////////////////////////////////////
// Monsters (1)
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MONSTER_SUMMONING_1)
  RandomNum(4,1) // 25% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(NearestEnemyOf(Myself),WIZARD_MONSTER_SUMMONING_1)
END


/////////////////////////////////////////////////////////////////////
// Summoning weapons
/////////////////////////////////////////////////////////////////////  


/////////////////////////////////////////////////////////////////////
// Energy Blade
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpellRES("spwi920")
  !HasItem("chillt",Myself) // Chill touch
  !HasItem("ghoult",Myself) // Ghoul touch
  !HasItem("melfmet",Myself) // Melf's Minute Meteor
  !HasItem("phanblad",Myself) // Phantom Blade
  !HasItem("eneblade",Myself) // Energy Blade
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    SpellRES("spwi920", Myself)
END


/////////////////////////////////////////////////////////////////////
// Melf meteor
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MELF_METEOR)
  !HasItem("chillt",Myself) // Chill touch
  !HasItem("ghoult",Myself) // Ghoul touch
  !HasItem("melfmet",Myself) // Melf's Minute Meteor
  !HasItem("phanblad",Myself) // Phantom Blade
  !HasItem("eneblade",Myself) // Energy Blade
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_MELF_METEOR)
END


/////////////////////////////////////////////////////////////////////
// Phantom blade
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_PHANTOM_BLADE)
  !HasItem("chillt",Myself) // Chill touch
  !HasItem("ghoult",Myself) // Ghoul touch
  !HasItem("melfmet",Myself) // Melf's Minute Meteor
  !HasItem("phanblad",Myself) // Phantom Blade
  !HasItem("eneblade",Myself) // Energy Blade
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_PHANTOM_BLADE)
END


/////////////////////////////////////////////////////////////////////
// Ghoul touch
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_GHOUL_TOUCH)
  !HasItem("chillt",Myself) // Chill touch
  !HasItem("ghoult",Myself) // Ghoul touch
  !HasItem("melfmet",Myself) // Melf's Minute Meteor
  !HasItem("phanblad",Myself) // Phantom Blade
  !HasItem("eneblade",Myself) // Energy Blade
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_GHOUL_TOUCH)
END


/////////////////////////////////////////////////////////////////////
// Chill touch
/////////////////////////////////////////////////////////////////////  
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CHILL_TOUCH)
  !HasItem("chillt",Myself) // Chill touch
  !HasItem("ghoult",Myself) // Ghoul touch
  !HasItem("melfmet",Myself) // Melf's Minute Meteor
  !HasItem("phanblad",Myself) // Phantom Blade
  !HasItem("eneblade",Myself) // Energy Blade
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_CHILL_TOUCH)
END


/////////////////////////////////////////////////////////////////////
// *********************  Damaging spells ************************ //
/////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////
// Level 6+ spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Dragon breath
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DRAGONS_BREATH)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(5,1) // 80% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DRAGONS_BREATH)
END


/////////////////////////////////////////////////////////////////////
// Abi dalzims horrid wilting
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_ABI_DALZIMS_HORRID_WILTING)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_ABI_DALZIMS_HORRID_WILTING)
END


/////////////////////////////////////////////////////////////////////
// Incendiary cloud
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_INCENDIARY_CLOUD)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_INCENDIARY_CLOUD)
END


/////////////////////////////////////////////////////////////////////
// Delayed blast fireball
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_DELAYED_BLAST_FIREBALL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(4,1) // 75% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_DELAYED_BLAST_FIREBALL)
END


/////////////////////////////////////////////////////////////////////
// Chain Lightning
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CHAIN_LIGHTNING)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CHAIN_LIGHTNING)
END


/////////////////////////////////////////////////////////////////////
// Wand of frost
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HasItemEquiped("_WAND06",Myself) // Wand of Frost
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  RandomNum(4,1) // 25% to use
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    UseItem("_WAND06",LastSeenBy(Myself)) // Wand of Frost
END


/////////////////////////////////////////////////////////////////////
// Level 4-5 spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Sunfire
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SUN_FIRE)
  Range(LastSeenBy(Myself),10)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_SUN_FIRE)
END


/////////////////////////////////////////////////////////////////////
// Cone of cold
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CONE_OF_COLD)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CONE_OF_COLD)
END


/////////////////////////////////////////////////////////////////////
// Ice storm
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_ICE_STORM)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStatGT(Myself,99,RESISTCOLD)
    CheckStat(Myself,6,SCRIPTINGSTATE6)  // Immunity evocation
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_ICE_STORM)
END


/////////////////////////////////////////////////////////////////////
// Polymorph other
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_POLYMORPH_OTHER)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_POLYMORPH_OTHER)
END


/////////////////////////////////////////////////////////////////////
// Contagion
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CONTAGION)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CONTAGION)
END


/////////////////////////////////////////////////////////////////////
// Level 3- spells
/////////////////////////////////////////////////////////////////////
IF
  !CheckStat(SixthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SixthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SixthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FifthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FifthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FifthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(FourthNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(FourthNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(FourthNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(ThirdNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(ThirdNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(ThirdNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(SecondNearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(SecondNearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(SecondNearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !CheckStat(NearestEnemyOf(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(NearestEnemyOf(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(NearestEnemyOf(Myself),0,MINORGLOBE)
  !StateCheck(NearestEnemyOf(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END


/////////////////////////////////////////////////////////////////////
// Skull trap
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SKULL_TRAP)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStatGT(Myself,50,MAGICDAMAGERESISTANCE)
    CheckStat(Myself,1,MINORGLOBE)
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SKULL_TRAP)
END


/////////////////////////////////////////////////////////////////////
// Fireball
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_FIREBALL)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStatGT(Myself,70,RESISTFIRE)
    CheckStat(Myself,1,MINORGLOBE)
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_FIREBALL)
END


/////////////////////////////////////////////////////////////////////
// Lightning bolt
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_LIGHTNING_BOLT)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  OR(2)
    CheckStatGT(Myself,99,RESISTELECTRICITY)
    CheckStat(Myself,1,MINORGLOBE)
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_LIGHTNING_BOLT)
END


/////////////////////////////////////////////////////////////////////
// Vampiric touch
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_VAMPIRIC_TOUCH)
  Range(LastSeenBy(Myself),10)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_VAMPIRIC_TOUCH)
END


/////////////////////////////////////////////////////////////////////
// Flame arrow
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_FLAME_ARROW)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_FLAME_ARROW)
END


/////////////////////////////////////////////////////////////////////
// Agannazar scorcher
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_AGANNAZAR_SCORCHER)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_AGANNAZAR_SCORCHER)
    Wait(6)
END


/////////////////////////////////////////////////////////////////////
// Magic missile
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MAGIC_MISSILE)
  !CheckStat(LastSeenBy(Myself),2,SCRIPTINGSTATE3) // Wizard shield
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_MAGIC_MISSILE)
END


/////////////////////////////////////////////////////////////////////
// Melf acid arrow
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_MELF_ACID_ARROW)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_MELF_ACID_ARROW)
END


/////////////////////////////////////////////////////////////////////
// Chromatic orb
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_CHROMATIC_ORB)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1)  // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_CHROMATIC_ORB)
END


/////////////////////////////////////////////////////////////////////
// Burning hands
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_BURNING_HANDS)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_BURNING_HANDS)
END


/////////////////////////////////////////////////////////////////////
// Shocking grasp
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_SHOCKING_GRASP)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_SHOCKING_GRASP)
END


/////////////////////////////////////////////////////////////////////
// Larloch minor drain
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  HaveSpell(WIZARD_LARLOCH_MINOR_DRAIN)
  !CheckStat(LastSeenBy(Myself),1,PROTECTION_FROM_MAGIC) 
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_PROTECTION)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_SHIELDING)
  !CheckStat(LastSeenBy(Myself),1,POTION_OF_MAGIC_BLOCKING)
  CheckStat(LastSeenBy(Myself),0,MINORGLOBE)
  !StateCheck(LastSeenBy(Myself),STATE_IMPROVEDINVISIBILITY)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
  See(LastSeenBy(Myself))
  !RandomNum(2,1) // 50% to cast
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(LastSeenBy(Myself),WIZARD_LARLOCH_MINOR_DRAIN)
END


/////////////////////////////////////////////////////////////////////
// Polymorph self
/////////////////////////////////////////////////////////////////////
IF
  Global("ja#polymorph","LOCALS",0)
  !GlobalTimerNotExpired("ja#confirm","LOCALS")
  !GlobalTimerNotExpired("ja#round","LOCALS")
THEN
  RESPONSE #100
    SetGlobalTimer("ja#confirm","LOCALS",6)
END

IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  Global("ja#disable_spellcasting","LOCALS",0)
  GlobalTimerNotExpired("ja#confirm","LOCALS")
  CheckStat(Myself,0,POLYMORPH_SELF) 
  HaveSpell(WIZARD_POLYMORPH_SELF)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#round","LOCALS",6)
    Spell(Myself,WIZARD_POLYMORPH_SELF)
    SetGlobal("ja#polymorph","LOCALS",1)
END


/////////////////////////////////////////////////////////////////////
// Polymorph forms
/////////////////////////////////////////////////////////////////////
IF
  !GlobalTimerNotExpired("ja#round","LOCALS")
  !GlobalTimerNotExpired("ja#polyform","LOCALS")
  CheckStat(Myself,1,POLYMORPH_SELF)
THEN
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi495",Myself)  // Sword spider
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi494",Myself)  // Ogre
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi497",Myself)  // Brown bear
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi496",Myself)  // Mustard jelly
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #100
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi499",Myself)  // Dread Wolf
    SetGlobal("ja#disable_spellcasting","LOCALS",1)
  RESPONSE #0 // Disable
    SetGlobalTimer("ja#polyform","LOCALS",24)
    SetGlobalTimer("ja#round","LOCALS",6)
    ForceSpellRES("spwi490",Myself)  // Natural form
    SetGlobal("ja#disable_spellcasting","LOCALS",0)
END

///////////////////////////////////////////////////////////////////////
// Fighting with a weapon, for NPC
///////////////////////////////////////////////////////////////////////

/////////////////////////////////////////////////////////////////////
// Find a slept target. this only work for PC's enemies            //
// because sleeping creatures are not considered as enemies        //
/////////////////////////////////////////////////////////////////////
IF
  !StateCheck(Player6,STATE_CHARMED)
  CheckStat(Player6,0,SANCTUARY)
  StateCheck(Player6,STATE_SLEEPING)
  See(Player6)
  False()
THEN
  RESPONSE #100
END

IF
  !StateCheck(Player5,STATE_CHARMED)
  CheckStat(Player5,0,SANCTUARY)
  StateCheck(Player5,STATE_SLEEPING)
  See(Player5)
  False()
THEN
  RESPONSE #100
END

IF
  !StateCheck(Player4,STATE_CHARMED)
  CheckStat(Player4,0,SANCTUARY)
  StateCheck(Player4,STATE_SLEEPING)
  See(Player4)
  False()
THEN
  RESPONSE #100
END

IF
  !StateCheck(Player3,STATE_CHARMED)
  CheckStat(Player3,0,SANCTUARY)
  StateCheck(Player3,STATE_SLEEPING)
  See(Player3)
  False()
THEN
  RESPONSE #100
END

IF
  !StateCheck(Player2,STATE_CHARMED)
  CheckStat(Player2,0,SANCTUARY)
  StateCheck(Player2,STATE_SLEEPING)
  See(Player2)
  False()
THEN
  RESPONSE #100
END

IF
  !StateCheck(Player1,STATE_CHARMED)
  CheckStat(Player1,0,SANCTUARY)
  StateCheck(Player1,STATE_SLEEPING)
  See(Player1)
  False()
THEN
  RESPONSE #100
END

IF
  Allegiance(Myself,Enemy)
  !StateCheck(LastSeenBy(Myself),STATE_CHARMED)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  See(LastSeenBy(Myself))
  !Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipRanged()
    AttackOneRound(LastSeenBy(Myself))
END  

IF
  Allegiance(Myself,Enemy)
  !StateCheck(LastSeenBy(Myself),STATE_CHARMED)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  StateCheck(LastSeenBy(Myself),STATE_SLEEPING)
  See(LastSeenBy(Myself))
  Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END  


/////////////////////////////////////////////////////////////////////
// Find a helpless target to attack
/////////////////////////////////////////////////////////////////////
IF
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(2)
    StateCheck(SixthNearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(SixthNearestEnemyOf(Myself),0,HELD)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(2)
    StateCheck(FifthNearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(FifthNearestEnemyOf(Myself),0,HELD)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(2)
    StateCheck(FourthNearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(FourthNearestEnemyOf(Myself),0,HELD)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(2)
    StateCheck(ThirdNearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(ThirdNearestEnemyOf(Myself),0,HELD)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(2)
    StateCheck(SecondNearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(SecondNearestEnemyOf(Myself),0,HELD)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)  
  OR(2)
    StateCheck(NearestEnemyOf(Myself),STATE_STUNNED)
    CheckStatGT(NearestEnemyOf(Myself),0,HELD)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  OR(2)
    StateCheck(LastSeenBy(Myself),STATE_STUNNED)
    CheckStatGT(LastSeenBy(Myself),0,HELD)
  See(LastSeenBy(Myself))  
  Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  OR(2)
    StateCheck(LastSeenBy(Myself),STATE_STUNNED)
    CheckStatGT(LastSeenBy(Myself),0,HELD)
  See(LastSeenBy(Myself))  
  !Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipRanged()
    AttackOneRound(LastSeenBy(Myself))
END

/////////////////////////////////////////////////////////////////////
// Find something to attack, which has bonus on to hit
/////////////////////////////////////////////////////////////////////
IF
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    StateCheck(SixthNearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(SixthNearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(SixthNearestEnemyOf(Myself),STATE_HELPLESS)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    StateCheck(FifthNearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(FifthNearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(FifthNearestEnemyOf(Myself),STATE_HELPLESS)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    StateCheck(FourthNearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(FourthNearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(FourthNearestEnemyOf(Myself),STATE_HELPLESS)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    StateCheck(ThirdNearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(ThirdNearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(ThirdNearestEnemyOf(Myself),STATE_HELPLESS)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  OR(3)
    StateCheck(SecondNearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(SecondNearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(SecondNearestEnemyOf(Myself),STATE_HELPLESS)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)  
  OR(3)
    StateCheck(NearestEnemyOf(Myself),STATE_SLOWED)
    StateCheck(NearestEnemyOf(Myself),STATE_BLIND)
    StateCheck(NearestEnemyOf(Myself),STATE_HELPLESS)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  OR(3)
    StateCheck(LastSeenBy(Myself),STATE_SLOWED)
    StateCheck(LastSeenBy(Myself),STATE_BLIND)
    StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  See(LastSeenBy(Myself))  
  Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  OR(3)
    StateCheck(LastSeenBy(Myself),STATE_SLOWED)
    StateCheck(LastSeenBy(Myself),STATE_BLIND)
    StateCheck(LastSeenBy(Myself),STATE_HELPLESS)
  See(LastSeenBy(Myself))  
  !Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipRanged()
    AttackOneRound(LastSeenBy(Myself))
END

/////////////////////////////////////////////////////////////////////
// Find something to attack, which has control of itself
/////////////////////////////////////////////////////////////////////
IF
  CheckStat(SixthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SixthNearestEnemyOf(Myself),STATE_CONFUSED)
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FifthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FifthNearestEnemyOf(Myself),STATE_CONFUSED)
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(FourthNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(FourthNearestEnemyOf(Myself),STATE_CONFUSED)
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(ThirdNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(ThirdNearestEnemyOf(Myself),STATE_CONFUSED)
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(SecondNearestEnemyOf(Myself),0,SANCTUARY)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(SecondNearestEnemyOf(Myself),STATE_CONFUSED)
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(NearestEnemyOf(Myself),0,SANCTUARY)  
  !StateCheck(NearestEnemyOf(Myself),STATE_PANIC)
  !StateCheck(NearestEnemyOf(Myself),STATE_FEEBLEMINDED)
  !StateCheck(NearestEnemyOf(Myself),STATE_CONFUSED)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END

IF
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)  
  !StateCheck(LastSeenBy(Myself),STATE_PANIC)
  !StateCheck(LastSeenBy(Myself),STATE_FEEBLEMINDED)
  !StateCheck(LastSeenBy(Myself),STATE_CONFUSED)
  !Range(LastSeenBy(Myself),5)
THEN
  RESPONSE #100
    EquipRanged()
    AttackOneRound(LastSeenBy(Myself))
END

/////////////////////////////////////////////////////////////////////
// Random attack (priority on melee range target)
/////////////////////////////////////////////////////////////////////

// three melee target
IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,1)
  OR(3)
    See(NearestEnemyOf(Myself))
    See(SecondNearestEnemyOf(Myself))
    See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,2)
  OR(3)
    See(SecondNearestEnemyOf(Myself))
    See(NearestEnemyOf(Myself))
    See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,3)
  OR(3)
    See(NearestEnemyOf(Myself))
    See(ThirdNearestEnemyOf(Myself))
    See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,4)
  OR(3)
    See(ThirdNearestEnemyOf(Myself))
    See(NearestEnemyOf(Myself))
    See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,5)
  OR(3)
    See(SecondNearestEnemyOf(Myself))
    See(ThirdNearestEnemyOf(Myself))
    See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(ThirdNearestEnemyOf(Myself),8)
  RandomNum(6,6)
  OR(3)
    See(ThirdNearestEnemyOf(Myself))
    See(SecondNearestEnemyOf(Myself))
    See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

// two melee target
IF
  !Range(ThirdNearestEnemyOf(Myself),8)
  Range(SecondNearestEnemyOf(Myself),8)
  RandomNum(2,1)
  OR(2)
    See(NearestEnemyOf(Myself))
    See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Range(ThirdNearestEnemyOf(Myself),8)
  Range(SecondNearestEnemyOf(Myself),8)
  RandomNum(2,2)
  OR(2)
    See(SecondNearestEnemyOf(Myself))
    See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

// one melee target
IF
  !Range(SecondNearestEnemyOf(Myself),8)
  Range(NearestEnemyOf(Myself),8)
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  Range(LastSeenBy(Myself),5)
  See(LastSeenBy(Myself))
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END


// No target in melee range, pick a random one
IF
  RandomNum(8,1)
  See(NearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(SixthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,2)
  See(FourthNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(SixthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,3)
  See(SixthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,4)
  See(FourthNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(SixthNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,5)
  See(SixthNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,6)
  See(SixthNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,7)
  See(SixthNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(WeakestOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  RandomNum(8,8)
  See(SixthNearestEnemyOf(Myself))
  See(FifthNearestEnemyOf(Myself))
  See(FourthNearestEnemyOf(Myself))
  See(ThirdNearestEnemyOf(Myself))
  See(SecondNearestEnemyOf(Myself))
  See(NearestEnemyOf(Myself))
  See(MostDamagedOf(Myself))
  False()
THEN
  RESPONSE #100
END

IF
  !Range(LastSeenBy(Myself),5)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
THEN
  RESPONSE #100
    EquipRanged()
    AttackOneRound(LastSeenBy(Myself))
END

IF
  Range(LastSeenBy(Myself),5)
  CheckStat(LastSeenBy(Myself),0,SANCTUARY)
THEN
  RESPONSE #100
    EquipMostDamagingMelee()
    AttackOneRound(LastSeenBy(Myself))
END

